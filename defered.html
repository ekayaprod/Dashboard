<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Automation Hub V3.7</title>
<style>
    body { font-family: system-ui, -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
    h1 { color: #fff; margin-bottom: 5px; font-weight: 800; letter-spacing: -1px; }
    .subtitle { color: #94a3b8; margin-bottom: 40px; }
    
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; max-width: 900px; width: 100%; }
    
    .card { background: #1e293b; border: 1px solid #334155; padding: 2rem; border-radius: 20px; text-align: center; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); display: flex; flex-direction: column; height: 100%; box-sizing: border-box; transition: transform 0.2s; }
    .card:hover { border-color: #475569; transform: translateY(-2px); }
    
    .card h2 { margin: 0 0 10px 0; color: #f8fafc; }
    .card p { color: #94a3b8; font-size: 0.9rem; line-height: 1.5; flex-grow: 1; }
    
    .btn { display: inline-flex; align-items: center; justify-content: center; color: #fff; text-decoration: none; padding: 16px 32px; border-radius: 12px; font-weight: 700; transition: all 0.2s; border: 1px solid transparent; box-shadow: 0 10px 20px -5px rgba(0,0,0,0.3); margin-top: 20px; font-size: 1.1rem; }
    .btn:active { transform: scale(0.98); }

    .c-quick { border-top: 4px solid #2563eb; }
    .btn-quick { background: #2563eb; border-color: #1d4ed8; }
    .btn-quick:hover { background: #1d4ed8; box-shadow: 0 15px 30px -5px rgba(37, 99, 235, 0.4); }

    .c-macro { border-top: 4px solid #7c3aed; }
    .btn-macro { background: #7c3aed; border-color: #6d28d9; }
    .btn-macro:hover { background: #6d28d9; box-shadow: 0 15px 30px -5px rgba(124, 58, 237, 0.4); }

    .features { text-align: left; margin-top: 20px; background: #0f172a; padding: 15px; border-radius: 10px; font-size: 0.85rem; color: #cbd5e1; border: 1px solid #334155; }
    .features div { margin-bottom: 6px; display: flex; align-items: center; }
    .features div::before { content: "‚Ä¢"; color: #fff; margin-right: 8px; font-weight: bold; }

    @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

    <h1>Automation Hub</h1>
    <div class="subtitle">Clean V3.7. Zero Comments.</div>

    <div class="grid">
        <div class="card c-quick">
            <h2>Quick Clicker V10.2</h2>
            <p>Single-target automation. Optimized with zero comments for clean bookmarklet generation.</p>
            <div class="features">
                <div>V5 Picker Engine (Sync)</div>
                <div>Text Input & Enter Support</div>
                <div>Hidden Element Warnings</div>
                <div>Memory Safe</div>
            </div>
            <a id="lnk_quick" href="#" class="btn btn-quick">‚ö° Quick Clicker</a>
        </div>

        <div class="card c-macro">
            <h2>Macro Builder V2.7</h2>
            <p>Record complex sequences. Exported macros are strictly sanitized.</p>
            <div class="features">
                <div>Synchronous Picker UI</div>
                <div>Smart "Wait For Element"</div>
                <div>Robust Error Handling</div>
                <div>Export to Standalone Bookmarklet</div>
            </div>
            <a id="lnk_macro" href="#" class="btn btn-macro">üéõÔ∏è Macro Builder</a>
        </div>
    </div>

<script>
function QuickClickerLogic() {
    if(window.__dc_v10){window.__dc_v10.destroy();return}
    if(!document.body) return alert('Page has no body.');

    class DC10 {
        constructor(){
            this.id = 'dc10-'+Math.random().toString(36).slice(2);
            this.state = { t1: null, t1Val: null, loop: false, pressEnter: false, wakeLock: null };
            this.cleanupFns = [];
            this.init();
        }

        init(){
            this.h = document.createElement('div');
            this.h.id = this.id;
            this.h.style.cssText = 'position:fixed;top:15px;right:15px;z-index:2147483647;font-family:system-ui,sans-serif';
            this.s = this.h.attachShadow({mode:'open'});
            
            this.s.innerHTML = '<style>' +
                ':host{all:initial;font-family:system-ui,sans-serif}' +
                '.box{background:#0f172a;color:#e2e8f0;width:260px;padding:16px;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.6);border:1px solid #334155;font-size:13px;box-sizing:border-box}' +
                '.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}' +
                'h3,b{margin:0;color:#f8fafc;font-size:14px;font-weight:700}' +
                'button{width:100%;background:#2563eb;color:#fff;border:none;padding:10px;border-radius:6px;cursor:pointer;font-weight:600;margin-top:8px;transition:0.2s}' +
                'button:hover{background:#1d4ed8}' +
                'button:disabled{background:#334155;color:#64748b;cursor:not-allowed}' +
                'input{width:100%;background:#1e293b;color:#fff;border:1px solid #334155;padding:8px;border-radius:6px;box-sizing:border-box;margin-top:5px;outline:none}' +
                'input:focus{border-color:#3b82f6}' +
                '.hidden{display:none!important}' +
                '.timer{font-size:32px;text-align:center;color:#60a5fa;margin:15px 0;font-family:monospace}' +
                '.warn{background:#713f12;color:#fef08a;padding:8px;border-radius:4px;margin-top:10px;font-size:11px;border:1px solid #ca8a04}' +
                '.toast{position:absolute;bottom:70px;left:50%;transform:translateX(-50%);background:#059669;color:white;padding:5px 10px;border-radius:4px;font-size:11px;white-space:nowrap;opacity:0;transition:opacity 0.5s}' +
            '</style>' +
            '<div class="box">' +
                '<div class="row"><b>QUICK CLICKER V10.2</b><span id="x" style="cursor:pointer">‚úï</span></div>' +
                '<div id="v1">' +
                    '<button id="pk">üéØ Pick Target</button>' +
                    '<div id="warn" class="hidden warn"></div>' +
                    '<div id="inp" class="hidden">' +
                        '<div style="font-size:11px;color:#94a3b8;margin-top:8px">Input Text</div>' +
                        '<input type="text" id="val">' +
                        '<div style="margin-top:5px"><input type="checkbox" id="ent" style="width:auto;margin-right:5px"> Press Enter</div>' +
                    '</div>' +
                    '<div style="font-size:11px;color:#94a3b8;margin-top:10px">Minutes Delay</div>' +
                    '<input type="number" id="mn" value="30">' +
                    '<button id="go" disabled>Start</button>' +
                '</div>' +
                '<div id="v2" class="hidden">' +
                    '<div class="timer" id="tm">00:00</div>' +
                    '<button id="cn" style="background:#ef4444">Stop</button>' +
                    '<div id="toast" class="toast">Wake Lock Active üîí</div>' +
                '</div>' +
            '</div>';
            
            this.q = s => this.s.querySelector(s);
            this.bind();
            document.body.appendChild(this.h);
        }

        bind(){
            this.q('#x').onclick=()=>this.destroy();
            this.q('#pk').onclick=()=>this.pick();
            this.q('#go').onclick=()=>this.start();
            this.q('#cn').onclick=()=>this.reset();
            this.q('#val').onchange=e=>this.state.t1Val=e.target.value;
            this.q('#ent').onchange=e=>this.state.pressEnter=e.target.checked;
        }

        add(t, ev, fn, opt) { t.addEventListener(ev, fn, opt); this.cleanupFns.push(()=>t.removeEventListener(ev, fn, opt)); }

        audit(el){
            const style = window.getComputedStyle(el);
            const rect = el.getBoundingClientRect();
            let issues = [];
            if(style.display === 'none') issues.push('Display is None');
            if(style.visibility === 'hidden') issues.push('Visibility is Hidden');
            if(style.opacity === '0') issues.push('Opacity is 0');
            if(rect.width === 0 || rect.height === 0) issues.push('Size is 0px');
            if(!el.isConnected) issues.push('Detached from DOM');

            const w = this.q('#warn');
            if(issues.length > 0) {
                w.innerText = '‚ö†Ô∏è Warning: Target is hidden (' + issues[0] + '). Automation may fail.';
                w.classList.remove('hidden');
            } else {
                w.classList.add('hidden');
            }
        }

        pick(){
            this.h.style.display='none';
            const hl=document.createElement('div');
            hl.style.cssText='position:absolute;border:2px solid #0078d4;background:rgba(0,120,212,0.2);pointer-events:none;z-index:2147483646';
            document.body.appendChild(hl);
            
            const s=document.createElement('style');
            s.id='dc-cur'; s.innerHTML='*{cursor:crosshair!important}';
            document.head.appendChild(s);

            const mv=e=>{
                if(e.shiftKey){ hl.style.display='none'; return; }
                hl.style.display='block';
                const r=e.target.getBoundingClientRect();
                hl.style.top=(r.top + window.scrollY)+'px';
                hl.style.left=(r.left + window.scrollX)+'px';
                hl.style.width=r.width+'px';
                hl.style.height=r.height+'px';
            };

            const cl=e=>{
                if(e.shiftKey) return;
                e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
                if(e.target.tagName==='IFRAME') alert('Cannot click inside IFrame');
                
                this.state.t1=e.target;
                this.audit(e.target);
                
                const t=e.target.tagName;
                const inp = this.q('#inp');
                if(t==='INPUT'||t==='TEXTAREA'||t==='SELECT') inp.classList.remove('hidden');
                else inp.classList.add('hidden');
                
                this.q('#go').disabled=false;
                this.q('#pk').style.background='#059669';
                this.q('#pk').innerText = 'Target: '+t;

                hl.remove(); s.remove();
                this.clearListeners();
                this.h.style.display='block';
                return false;
            };

            this.add(document, 'mousemove', mv);
            this.add(document, 'click', cl, true);
        }

        clearListeners() { this.cleanupFns.forEach(fn=>fn()); this.cleanupFns = []; }

        async start(){
            const m = parseFloat(this.q('#mn').value)||0;
            if(m<=0) return alert('Invalid Time');
            
            try { 
                if('wakeLock' in navigator) {
                    this.state.wakeLock = await navigator.wakeLock.request('screen');
                    const t = this.q('#toast');
                    t.style.opacity = '1';
                    setTimeout(()=>t.style.opacity='0', 3000);
                }
            } catch(e){}
            
            const end = Date.now() + (m*60000);
            this.q('#v1').classList.add('hidden');
            this.q('#v2').classList.remove('hidden');
            
            const elTm = this.q('#tm');

            this.iv = setInterval(()=>{
                const r = end - Date.now();
                if(r<=0) { clearInterval(this.iv); this.exec(elTm); return; }
                const mm=Math.floor(r/60000).toString().padStart(2,'0');
                const ss=Math.floor((r%60000)/1000).toString().padStart(2,'0');
                elTm.innerText = `${mm}:${ss}`;
                document.title = `‚è≥ ${mm}:${ss}`;
            },1000);
        }

        exec(elTm){
            const el = this.state.t1;
            const display = elTm || this.q('#tm');
            
            if(!el || !el.isConnected) {
                alert('FAILED: Target detached (Page refreshed?).');
                display.innerText='FAIL'; return;
            }

            if(this.state.t1Val && (el.matches('input,textarea,select'))){
                el.focus(); el.value=this.state.t1Val;
                el.dispatchEvent(new Event('input',{bubbles:true}));
                el.dispatchEvent(new Event('change',{bubbles:true}));
                if(this.state.pressEnter){
                    const k={key:'Enter',code:'Enter',keyCode:13,which:13,bubbles:true};
                    el.dispatchEvent(new KeyboardEvent('keydown',k));
                    el.dispatchEvent(new KeyboardEvent('keyup',k));
                }
            }
            ['mousedown','mouseup','click'].forEach(e=>el.dispatchEvent(new MouseEvent(e,{bubbles:true, cancelable:true})));
            display.innerText='DONE';
        }

        reset(){
            clearInterval(this.iv);
            if(this.state.wakeLock) this.state.wakeLock.release();
            this.clearListeners();
            document.title = 'Stopped';
            this.q('#v1').classList.remove('hidden');
            this.q('#v2').classList.add('hidden');
        }

        destroy(){ this.reset(); this.h.remove(); delete window.__dc_v10; }
    }
    window.__dc_v10 = new DC10();
}

function MacroBuilderLogic() {
    if(window.__mb_v1){window.__mb_v1.destroy();return}
    if(!document.body) return alert('Page has no body.');

    class MacroBuilder {
        constructor(){
            this.id = 'mb-'+Math.random().toString(36).slice(2);
            this.steps = [];
            this.cleanupFns = [];
            this.init();
        }

        init(){
            this.h = document.createElement('div');
            this.h.style.cssText = 'position:fixed;top:15px;right:15px;z-index:2147483647;font-family:system-ui,sans-serif';
            this.s = this.h.attachShadow({mode:'open'});
            this.render();
            document.body.appendChild(this.h);
        }

        render(){
            this.s.innerHTML = '<style>' +
                ':host{all:initial;font-family:system-ui,sans-serif}' +
                '.box{background:#1e1b4b;color:#e2e8f0;width:320px;padding:16px;border-radius:12px;box-shadow:0 20px 50px rgba(0,0,0,0.7);border:1px solid #4338ca;font-size:13px;box-sizing:border-box}' +
                '.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}' +
                'h3,b{margin:0;color:#f8fafc;font-size:14px;font-weight:700}' +
                'button{width:100%;background:#4f46e5;color:#fff;border:none;padding:10px;border-radius:6px;cursor:pointer;font-weight:600;margin-top:8px;transition:0.2s}' +
                'button:hover{background:#4338ca}' +
                'button:disabled{background:#334155;color:#64748b;cursor:not-allowed}' +
                'input{width:100%;background:#1e293b;color:#fff;border:1px solid #334155;padding:8px;border-radius:6px;box-sizing:border-box;margin-top:5px;outline:none}' +
                'input:focus{border-color:#3b82f6}' +
                '.hidden{display:none!important}' +
                '.list{max-height:300px;overflow-y:auto;margin:15px 0;background:#1e293b;border-radius:6px;padding:5px;border:1px solid #334155}' +
                '.step{background:#0f172a;padding:8px;margin-bottom:5px;border-radius:4px;border:1px solid #334155;display:flex;align-items:center;gap:8px}' +
                '.step-idx{background:#4f46e5;color:#fff;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0}' +
                '.step-info{flex-grow:1;overflow:hidden}' +
                '.step-sel{font-family:monospace;color:#64748b;font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}' +
                '.step-del{cursor:pointer;color:#ef4444;font-size:14px}' +
                '.export-area{margin-top:15px;border-top:1px solid #334155;padding-top:10px}' +
                '.bm-btn{display:block;background:#059669;color:#fff;text-align:center;padding:10px;border-radius:6px;text-decoration:none;font-weight:bold;border:2px dashed #34d399}' +
                '.bm-btn:hover{background:#047857}' +
                'input.delay{width:40px;background:#0f172a;border:1px solid #334155;color:#fff;border-radius:4px;padding:2px;font-size:11px;text-align:center}' +
                '.empty-msg{text-align:center;color:#64748b;padding:20px;font-style:italic}' +
            '</style>' +
            '<div class="box">' +
                '<div class="row"><h3>MACRO BUILDER V2.7</h3><span id="x" style="cursor:pointer">‚úï</span></div>' +
                '<div id="list" class="list"><div class="empty-msg">No steps yet.<br>Click Add Step to begin.</div></div>' +
                '<button id="add">‚ûï Add Step</button>' +
                '<button id="exp" style="background:#db2777">‚ö° Export Bookmarklet</button>' +
                '<div id="out" class="export-area" style="display:none">' +
                    '<p style="text-align:center;color:#e2e8f0;margin:0 0 10px 0">Drag button to toolbar:</p>' +
                    '<a id="lnk" href="#" class="bm-btn">ü§ñ My Macro</a>' +
                '</div>' +
            '</div>';
            
            this.q = s => this.s.querySelector(s);
            this.bind();
        }

        bind(){
            this.q('#x').onclick=()=>this.destroy();
            this.q('#add').onclick=()=>this.pick();
            this.q('#exp').onclick=()=>this.compile();
        }

        add(t, ev, fn, opt) { t.addEventListener(ev, fn, opt); this.cleanupFns.push(()=>t.removeEventListener(ev, fn, opt)); }
        
        clearListeners() { this.cleanupFns.forEach(fn=>fn()); this.cleanupFns = []; }

        getSel(el){
            if(el.id) return '#'+el.id;
            let path = el.tagName.toLowerCase();
            if(el.classList.length) path += '.' + [...el.classList].join('.');
            if(document.querySelectorAll(path).length > 1 && el.parentElement){
                 let i=1, s=el; while(s=s.previousElementSibling)i++;
                 path += ':nth-child('+i+')';
            }
            return path;
        }

        pick(){
            this.h.style.display='none';
            const hl=document.createElement('div');
            hl.style.cssText='position:absolute;border:2px solid #a855f7;background:rgba(168,85,247,0.2);pointer-events:none;z-index:999999';
            document.body.appendChild(hl);
            
            const s=document.createElement('style');
            s.id='dc-cur'; s.innerHTML='*{cursor:crosshair!important}';
            document.head.appendChild(s);

            const stopPicking = () => {
                hl.remove(); s.remove();
                this.h.style.display='block';
                this.clearListeners();
            };

            const mv=e=>{
                if(e.shiftKey){ hl.style.display='none'; return; }
                hl.style.display='block';
                const r=e.target.getBoundingClientRect();
                hl.style.top=(r.top + window.scrollY)+'px';
                hl.style.left=(r.left + window.scrollX)+'px';
                hl.style.width=r.width+'px';
                hl.style.height=r.height+'px';
            };

            const cl=e=>{
                if(e.shiftKey) return;
                e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
                
                const sel = this.getSel(e.target);
                const tag = e.target.tagName;
                
                let val = null;
                let enter = false;
                if(tag==='INPUT'||tag==='TEXTAREA'||tag==='SELECT'){
                    val = prompt('Enter text to type (leave empty to just click):');
                    if(val) enter = confirm('Press Enter after typing?');
                }

                this.steps.push({ sel: sel, val: val, enter: enter, delay: 1 });

                stopPicking();
                this.refreshList();
                return false;
            };

            this.add(document, 'mousemove', mv);
            this.add(document, 'click', cl, true);
        }

        refreshList(){
            const l = this.q('#list');
            if(this.steps.length===0) { l.innerHTML = '<div class="empty-msg">No steps yet.</div>'; return; }
            l.innerHTML = '';
            
            this.steps.forEach((s, i) => {
                const d = document.createElement('div');
                d.className = 'step';
                let safeVal = s.val ? s.val.replace(/</g,'&lt;').replace(/>/g,'&gt;') : '';
                let desc = s.val ? 'Type "'+safeVal+'"' : 'Click';
                d.innerHTML = `
                    <div class="step-idx">${i+1}</div>
                    <div class="step-info">
                        <div style="font-weight:bold;font-size:11px">${desc}</div>
                        <div class="step-sel">${s.sel}</div>
                    </div>
                    <div style="font-size:10px;color:#a5b4fc">Wait(s)</div>
                    <input type="number" class="delay" value="${s.delay}" data-idx="${i}">
                    <div class="step-del" data-idx="${i}">‚úï</div>
                `;
                l.appendChild(d);
            });

            l.querySelectorAll('.delay').forEach(ip => {
                ip.onchange = (e) => this.steps[e.target.dataset.idx].delay = parseFloat(e.target.value);
            });
            l.querySelectorAll('.step-del').forEach(btn => {
                btn.onclick = (e) => {
                    this.steps.splice(e.target.dataset.idx, 1);
                    this.refreshList();
                };
            });
        }

        compile(){
            if(this.steps.length===0) return alert('Add steps first');
            
            const json = JSON.stringify(this.steps).replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$');

            const runtime = `(async function(){
                const steps = ${json}; 
                const wait = ms => new Promise(r => setTimeout(r, ms));
                
                const find = async (sel) => {
                    const end = Date.now() + 10000;
                    while(Date.now() < end) {
                        const el = document.querySelector(sel);
                        if(el && el.isConnected) return el;
                        await wait(200);
                    }
                    return null;
                };
                
                const toast = (msg) => {
                    let t = document.getElementById('mb-toast');
                    if(!t){
                        t = document.createElement('div');
                        t.id = 'mb-toast';
                        t.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#1e293b;color:#fff;padding:10px 20px;border-radius:8px;z-index:999999;font-family:sans-serif;box-shadow:0 10px 20px rgba(0,0,0,0.5);border:1px solid #4f46e5';
                        document.body.appendChild(t);
                    }
                    t.innerText = msg;
                    setTimeout(()=>t.remove(), 3000);
                };

                for(let i=0; i<steps.length; i++){
                    const s = steps[i];
                    toast('Step '+(i+1)+': Waiting for target...');
                    
                    if(s.delay > 0) await wait(s.delay * 1000);

                    const el = await find(s.sel);
                    if(!el) { alert('Step '+(i+1)+' Failed: Element not found or hidden ('+s.sel+')'); return; }

                    if(s.val !== null){
                        el.focus(); el.value = s.val;
                        el.dispatchEvent(new Event('input',{bubbles:true}));
                        el.dispatchEvent(new Event('change',{bubbles:true}));
                        if(s.enter){
                            const k={key:'Enter',code:'Enter',keyCode:13,which:13,bubbles:true};
                            el.dispatchEvent(new KeyboardEvent('keydown',k));
                            el.dispatchEvent(new KeyboardEvent('keyup',k));
                        }
                    }
                    ['mousedown','mouseup','click'].forEach(evt => {
                         el.dispatchEvent(new MouseEvent(evt, {bubbles:true,cancelable:true,view:window}));
                    });
                }
                toast('Sequence Complete! ‚úÖ');
            })();`;
            
            const href = "javascript:" + encodeURIComponent(runtime.replace(/\s+/g,' ').trim());
            const area = this.q('#out');
            const link = this.q('#lnk');
            link.href = href;
            area.style.display = 'block';
        }

        destroy(){ this.clearListeners(); this.h.remove(); delete window.__mb_v1; }
    }
    window.__mb_v1 = new MacroBuilder();
}

function generate(func) {
    let source = func.toString();
    source = "(" + source + ")();";
    return "javascript:" + encodeURIComponent(source.replace(/\s+/g, ' ').trim());
}

try {
    document.getElementById('lnk_quick').href = generate(QuickClickerLogic);
    document.getElementById('lnk_macro').href = generate(MacroBuilderLogic);
} catch(e) {
    console.error("Error generating bookmarklets:", e);
    alert("Generation failed. See console.");
}
</script>

</body>
</html>

