<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MailTo Generator</title>
    <link rel="stylesheet" href="style.css">

    <!-- CORE SCRIPTS -->
    <script src="js/app-core.js"></script>
    <script src="js/app-data.js"></script>
    <script src="js/app-ui.js"></script>

    <!-- APP MODULE -->
    <script 
        type="module" 
        src="js/mailto-app.js" 
        defer 
        onerror="window.addEventListener('DOMContentLoaded', function() { var el = document.getElementById('app-startup-error'); if(el) { el.innerHTML = '<strong>Application Failed to Load</strong><p>A critical script (mailto-app.js) could not be loaded.</p>'; el.classList.remove('hidden'); } });"
    ></script>
</head>
<body class="mailto-page">
    <div id="navbar-container"></div>

    <div class="app-container">
        <div class="panel">
            <div class="main-content">
                <div id="app-startup-error" class="hidden app-startup-banner"></div>
                
                <!-- SECTION 1: LIBRARY (Accordion) -->
                <div id="library-section" class="accordion-section collapsed">
                    <div class="accordion-header" id="library-header">
                        <div class="section-header-wrapper" style="margin:0; flex-grow:1;">
                            <h3 class="section-header">Template Library</h3>
                        </div>
                        <div class="button-group" style="margin-right: 10px;">
                             <button id="btn-settings" class="icon-btn" title="Settings" style="padding:2px;">‚öôÔ∏è</button>
                             <button id="btn-new-folder" class="icon-btn" title="New Folder" style="padding:2px;">üìÇ+</button>
                        </div>
                        <span class="accordion-icon">‚ñº</span>
                    </div>
                    
                    <div class="accordion-content">
                        <div id="breadcrumb-container" class="breadcrumb-container"></div>
                        <div id="tree-list-container" class="tree-list-container"></div>
                    </div>
                </div>

                <!-- SECTION 2: EDITOR (Accordion - Default Open) -->
                <div id="editor-section" class="accordion-section expanded">
                    <div class="accordion-header" id="editor-header">
                        <h3 class="section-header">Editor & Upload</h3>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <button id="btn-clear-all" class="button-base button-danger" style="padding: 2px 8px; font-size: 0.75rem;">Clear All</button>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                    </div>
                    
                    <div class="accordion-content">
                        <div class="editor-container">
                            <!-- Upload Zone -->
                            <div id="upload-wrapper" class="upload-wrapper">
                                <input type="file" id="msg-upload" accept=".msg,.oft,.eml,.email">
                                <label for="msg-upload" class="button-base button-primary">
                                    Upload Email File
                                </label>
                                <p>Drag & drop .msg, .oft, .eml</p>
                            </div>

                            <!-- Input Fields -->
                            <div class="form-group">
                                <input type="text" id="result-to" class="sidebar-input" placeholder="To">
                            </div>
                            <div class="grid-2-tight">
                                <div class="form-group">
                                    <input type="text" id="result-cc" class="sidebar-input" placeholder="CC">
                                </div>
                                <div class="form-group">
                                    <input type="text" id="result-bcc" class="sidebar-input" placeholder="BCC">
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="text" id="result-subject" class="sidebar-input" placeholder="Subject">
                            </div>
                            
                            <!-- Growing Body Field -->
                            <div class="form-group body-group">
                                <textarea id="result-body" class="sidebar-textarea body-input" placeholder="Body content..."></textarea>
                            </div>
                            
                            <!-- Actions -->
                            <div class="grid-2">
                                <button id="btn-generate" class="button-base button-primary">Generate Link</button>
                                <button id="btn-save-to-library" class="button-base button-success">Save Template</button>
                            </div>

                            <!-- Hidden Output (Shows only when needed) -->
                            <div id="output-wrapper" class="hidden" style="margin-top:1rem;">
                                <div class="form-group">
                                    <label>Template Name</label>
                                    <input type="text" id="save-template-name" class="sidebar-input">
                                </div>
                                <div class="form-group">
                                    <label>MailTo Link</label>
                                    <div style="display:flex; gap:5px;">
                                        <input type="text" id="result-mailto" class="sidebar-input" readonly>
                                        <button id="copy-mailto-btn" class="button-base">Copy</button>
                                    </div>
                                </div>
                                <a href="#" id="result-link" target="_blank" class="button-base button-primary" style="width:100%; text-align:center;">Open in Client</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content"></div>
    </div>
    <div id="toast" class="toast"></div>
</body>
</html>
