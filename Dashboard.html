<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Call Dashboard</title>
    <style>
        :root {
            --bg-color: #f0f4f8; --panel-bg: #ffffff; --border-color: #dce4ec;
            --text-color: #334155; --subtle-text: #64748b; --primary-color: #3b82f6;
            --danger-color: #ef4444; --success-color: #22c55e; --info-bg: #f8fafc;
            --font-family: system-ui, sans-serif;
        }
        body {
            font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color);
            margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }
        .app-container {
            display: grid; grid-template-columns: minmax(320px, 400px) 1fr;
            height: 100vh; gap: 0.75rem; padding: 0.75rem; box-sizing: border-box;
        }
        .panel {
            background-color: var(--panel-bg); border-radius: 0.5rem; border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden;
        }
        .sidebar-content { padding: 1rem; overflow-y: auto; height: 100%; }
        .sidebar-input, .sidebar-textarea {
            width: 100%; box-sizing: border-box; font-size: 0.9rem; padding: 0.5rem;
            border-radius: 0.375rem; border: 1px solid var(--border-color); margin-bottom: 0.75rem;
            font-family: inherit; background-color: #f8fafc;
        }
        .sidebar-input:focus, .sidebar-textarea:focus { outline: 2px solid var(--primary-color); outline-offset: -1px; background-color: white; }
        .sidebar-textarea { resize: vertical; min-height: 80px; }
        .button-base {
            padding: 0.5rem 0.8rem; font-size: 0.9rem; border: 1px solid var(--border-color);
            border-radius: 0.375rem; cursor: pointer; background-color: #fff; transition: background-color 0.2s;
            font-weight: 500;
        }
        .button-base:hover { background-color: var(--bg-color); }
        .button-primary { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .button-primary:hover { background-color: #2563eb; }
        .button-danger { background-color: var(--danger-color); color: white; border-color: var(--danger-color); }
        .button-danger:hover { background-color: #dc2626; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { font-size: 0.9rem; font-weight: 500; margin-bottom: 0.25rem; display: block; }
        .button-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .divider { border-top: 1px solid var(--border-color); margin: 1.25rem 0; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(100,116,139,0.5);
            display: flex; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white; padding: 1.5rem; border-radius: 0.75rem; max-width: 400px; width: 90%; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        .modal-content h3 { margin-top: 0; }
        .modal-content p { color: var(--subtle-text); margin-bottom: 1.5rem; }
        
        .notepad-panel { padding: 0; }
        .tabs-container { display: flex; align-items: center; padding: 0.25rem 0.75rem 0 0.75rem; border-bottom: 1px solid var(--border-color); background-color: var(--info-bg); flex-shrink: 0; gap: 0.25rem; }
        .tab { padding: 0.6rem 0.8rem; cursor: pointer; border: 1px solid transparent; border-bottom: none; border-radius: 0.375rem 0.375rem 0 0; position: relative; bottom: -1px; color: var(--subtle-text); }
        .tab.active { background-color: var(--panel-bg); border-color: var(--border-color); font-weight: 500; color: var(--text-color); }
        .tab:not(.active):hover { background-color: var(--bg-color); }
        .tab-title { max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .note-actions-bar { margin-left: auto; }
        .notepad-editor { width: 100%; height: 100%; border: none; resize: none; padding: 0.75rem; font-size: 0.9rem; line-height: 1.6; box-sizing: border-box; font-family: inherit; }
        .notepad-editor:focus { outline: none; }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="panel sidebar-panel">
            <div class="sidebar-content">
                <h3>Data Management</h3>
                <div class="button-group">
                    <button id="import-csv-btn" class="button-base">Import CSV</button>
                    <input type="file" id="csv-file-input" accept=".csv" class="hidden">
                    <button id="export-csv-btn" class="button-base">Export to CSV</button>
                </div>
                <div class="divider"></div>
                <h3>Applications</h3>
                <div class="button-group" style="margin-bottom: 1rem;">
                    <button id="add-new-app-btn" class="button-base button-primary">ï¼‹ Add New App</button>
                </div>
                <div class="form-group">
                    <label for="app-select">Select Application</label>
                    <select id="app-select" class="sidebar-input"></select>
                </div>
                <div id="app-details-form" class="hidden">
                    <div class="form-group">
                        <label for="edit-app-name">Official Name / Other Name</label>
                        <input type="text" id="edit-app-name" class="sidebar-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-app-urls">URLs (separated by ;)</label>
                        <textarea id="edit-app-urls" class="sidebar-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-app-escalation">Escalation Details</label>
                        <textarea id="edit-app-escalation" class="sidebar-textarea"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="save-changes-btn" class="button-base button-primary">Save Changes</button>
                        <button id="delete-app-btn" class="button-base button-danger">Delete App</button>
                    </div>
                </div>
            </div>
        </aside>
        <main class="panel notepad-panel">
            <div id="tabs-container" class="tabs-container">
                <div class="note-actions-bar">
                    <button id="new-tab-btn" class="button-base" title="New Note">+</button>
                </div>
            </div>
            <textarea id="notepad-editor" class="notepad-editor" placeholder="Start typing..."></textarea>
        </main>
    </div>

    <script>
    {
        // --- STATE INITIALIZATION ---
        let appData = JSON.parse(localStorage.getItem('dashboard_app_data')) || [];
        let notesData = JSON.parse(localStorage.getItem('dashboard_notepad_state')) || [];
        let activeNoteId = null;

        // --- DOM ELEMENT CACHE ---
        const D = new Proxy({}, { get: (_, id) => document.getElementById(id) });

        // --- CORE LOGIC ---
        const renderAppData = () => {
            const selectedValue = D['app-select'].value;
            D['app-select'].innerHTML = '<option value="">-- Select an App --</option>';
            appData.sort((a, b) => a.name.localeCompare(b.name)).forEach((app, i) => {
                const option = new Option(app.name, i);
                D['app-select'].add(option);
            });
            if (selectedValue && appData[selectedValue]) D['app-select'].value = selectedValue;
            else D['app-details-form'].classList.add('hidden');
        };

        const renderNotesData = () => {
            if (notesData.length === 0) notesData.push({ id: Date.now(), title: 'Note 1', content: '' });
            if (!notesData.some(n => n.id === activeNoteId)) activeNoteId = notesData[0].id;
            
            D['tabs-container'].querySelectorAll('.tab').forEach(t => t.remove());
            const fragment = document.createDocumentFragment();
            notesData.forEach(note => {
                const tab = document.createElement('div');
                tab.className = `tab ${note.id === activeNoteId ? 'active' : ''}`;
                tab.dataset.id = note.id;
                tab.innerHTML = `<span class="tab-title">${note.title}</span>`;
                fragment.appendChild(tab);
            });
            D['tabs-container'].prepend(fragment);
            
            const activeNote = notesData.find(n => n.id === activeNoteId);
            D['notepad-editor'].value = activeNote ? activeNote.content : '';
        };

        const saveAppData = () => localStorage.setItem('dashboard_app_data', JSON.stringify(appData));
        const saveNotesData = () => localStorage.setItem('dashboard_notepad_state', JSON.stringify(notesData));

        // --- EVENT LISTENERS ---
        D['app-select'].addEventListener('change', () => {
            const index = D['app-select'].value;
            D['app-details-form'].classList.toggle('hidden', index === '');
            if (index !== '') {
                const app = appData[index];
                D['edit-app-name'].value = app.name;
                D['edit-app-urls'].value = app.urls;
                D['edit-app-escalation'].value = app.escalation;
            }
        });

        D['add-new-app-btn'].addEventListener('click', () => {
            D['app-select'].value = '';
            D['edit-app-name'].value = '';
            D['edit-app-urls'].value = '';
            D['edit-app-escalation'].value = '';
            D['app-details-form'].classList.remove('hidden');
            D['edit-app-name'].focus();
        });

        D['save-changes-btn'].addEventListener('click', () => {
            const name = D['edit-app-name'].value.trim();
            if (!name) return;
            const app = { name, urls: D['edit-app-urls'].value.trim(), escalation: D['edit-app-escalation'].value.trim() };
            const index = D['app-select'].value;
            let newIndex;
            if (index !== '') {
                appData[index] = app;
                newIndex = index;
            } else {
                appData.push(app);
                newIndex = appData.length - 1;
            }
            saveAppData();
            renderAppData();
            D['app-select'].value = newIndex;
        });

        D['delete-app-btn'].addEventListener('click', () => {
            const index = D['app-select'].value;
            if (index === '') return;
            appData.splice(index, 1);
            saveAppData();
            renderAppData();
        });

        D['import-csv-btn'].addEventListener('click', () => D['csv-file-input'].click());
        D['csv-file-input'].addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const text = await file.text();
            const rows = text.split(/\r?\n/).slice(1).filter(row => row);
            const newApps = rows.map(row => {
                const [name, urls, escalation] = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(v => v.replace(/^"|"$/g, '').trim());
                return { name, urls, escalation };
            });
            appData.push(...newApps); // Simple append, as per trusted environment
            saveAppData();
            renderAppData();
            e.target.value = '';
        });

        D['export-csv-btn'].addEventListener('click', () => {
            if (appData.length === 0) return;
            const headers = "officialName/otherKnownName,urls,escalationDetails";
            const csvContent = appData.map(app => `"${app.name || ''}","${app.urls || ''}","${app.escalation || ''}"`).join('\r\n');
            const blob = new Blob([headers + '\r\n' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `dashboard-export.csv`;
            link.click();
            URL.revokeObjectURL(url);
        });

        D['tabs-container'].addEventListener('click', (e) => {
            if (e.target.id === 'new-tab-btn') {
                const newId = Date.now();
                notesData.push({ id: newId, title: `Note ${notesData.length + 1}`, content: '' });
                activeNoteId = newId;
            } else {
                const tab = e.target.closest('.tab');
                if (tab) activeNoteId = Number(tab.dataset.id);
            }
            saveNotesData();
            renderNotesData();
        });

        D['notepad-editor'].addEventListener('input', () => {
            const note = notesData.find(n => n.id === activeNoteId);
            if (note) {
                note.content = D['notepad-editor'].value;
                saveNotesData();
            }
        });

        // --- INITIALIZATION ---
        renderAppData();
        renderNotesData();
    }
    </script>
</body>
</html>
